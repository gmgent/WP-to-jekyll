<!DOCTYPE html>
<html dir="ltr" lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <title>Another Ruby model | Krister Axel</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0; maximum-scale=1.0; user-scalable=yes" name="viewport"/>

<!-- Custom Favicon -->
<link rel="shortcut icon" href="http://blog.kristeraxel.com/wp-content/uploads/2012/11/favicon.ico"/>

<!-- style sheets -->
<link rel="stylesheet" type="text/css" href="/css/style.css" media="all" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.9.0/build/reset-fonts-grids/reset-fonts-grids.css&2.9.0/build/base/base-min.css"> 

    </head>

    <body>
	<!-- the id on the containing div determines the page width. -->
	<!-- #doc = 750px; #doc2 = 950px; #doc3 = 100%; #doc4 = 974px -->
	<div id="doc">					
		<div id="hd">
			<div id="header" class="col-full">

   
   <div id="logo">
        <a href="/" title="spotlights in the wild">
            <img src="http://blog.kristeraxel.com/wp-content/uploads/2012/11/header11.jpg" alt="Krister Axel" />
        </a>
   </div><!-- /#logo -->
   
</div><!-- /#header -->
<div id="navigation" class="col-full">
	<ul id="main-nav" class="nav">
		<li id="menu-item-9" class="menu-item">
		    <a href="/" >the latest</a></li>
		
		<li id="menu-item-9999" class="menu-item">
	        <a href="/Archive/">Archive</a></li>
	
		<li id="menu-item-99" class="menu-item">
		    <a href="/Info/" >Info</a></li>

		<li id="menu-item-99999" class="menu-item">
            <a href="/Press/" >Press</a></li>

		<li id="menu-item-999999" class="menu-item">
	        <a href="/Search/">Search</a></li>
	
        <li id="menu-item-999999" class="menu-item">
            <a href="/Contact/">Contact</a></li>
        
    </ul>	
</div><!-- /#navigation -->
		</div>
		<div id="bd" class="container">
			<h2 class="title">
                Another Ruby model
            </h2>
			<p>class State &lt; ActiveRecord::Base<br /><br />
  has_one :location<br /><br />
  has_one :user<br /><br />
  has_one :hood<br /><br />
  has_one :option</p><br />
<br />
<br />
<p>  attr_reader :return_message<br /><br />
  PRICE_OF_UNIFORM = 22<br /><br />
  BURGER_LIMIT = 5</p><br />
<br />
<br />
<p>  def isactive?<br /><br />
    (self.current_enthusiasm &gt; 0)<br /><br />
  end</p><br />
<br />
<br />
<p>  def lose_enthuse!(factor = 1)<br /><br />
    self.current_enthusiasm -= (1 * factor)<br /><br />
    self.name = "You are visiting"<br /><br />
  end</p><br />
<br />
<br />
<p>  def change_location!(location)<br /><br />
    self.location_id = location<br /><br />
  end</p><br />
<br />
<br />
<p>  def reset_enthuse!<br /><br />
    self.current_enthusiasm = 100<br /><br />
  end</p><br />
<br />
<br />
<p>  def change_hood!(hood)<br /><br />
    self.hood_id = hood<br /><br />
    self.location_id = 1<br /><br />
    self.name = "Please choose somewhere to visit:"<br /><br />
  end</p><br />
<br />
<br />
<p>  def set_option!(id)<br /><br />
    self.option_id = id<br /><br />
  end</p><br />
<br />
<br />
<p>  def choose_option?<br /><br />
    s=""<br /><br />
    @option = Option.find_by_id(self.option_id)<br /><br />
    @thisguy=Actor.find_by_user_id(self.user_id)<br /><br />
    if @thisguy.cash &lt; @option.cash_price then<br /><br />
      s= s &lt;&lt; "You need at least $#{@option.cash_price}. "<br /><br />
    end<br /><br />
    if self.current_enthusiasm &lt; @option.enthuse_price then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.enthuse_price} enthusiasm points. "<br /><br />
    end<br /><br />
    if (@thisguy.has_uniform &lt; @option.uniform_needed) and (@option.give_uniform &lt; 1) then<br /><br />
      s= s &lt;&lt; "You need a uniform for this and you can&#039;t get one here. "<br /><br />
    end<br /><br />
    if (@thisguy.has_uniform &lt; @option.uniform_needed) and (@option.give_uniform == 1) and (@thisguy.cash &lt; PRICE_OF_UNIFORM) then<br /><br />
      s= s &lt;&lt; "You need a uniform for this and you can&#039;t afford one - you are short $#{PRICE_OF_UNIFORM - @thisguy.cash}. "<br /><br />
    end<br /><br />
    if (@thisguy.has_job &gt;= @option.give_job) and (@option.give_job &gt; 0) then<br /><br />
      s= s &lt;&lt; "You already have a job. "<br /><br />
    end<br /><br />
    if @thisguy.charisma &lt; @option.charisma_needed then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.charisma_needed} charisma points. "<br /><br />
    end<br /><br />
    if @thisguy.skill &lt; @option.skill_needed then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.skill_needed} skill points. "<br /><br />
    end<br /><br />
    if @thisguy.savvy &lt; @option.savvy_needed then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.savvy_needed} savvy points. "<br /><br />
    end<br /><br />
    if @thisguy.looks &lt; @option.looks_needed then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.looks_needed} looks points. "<br /><br />
    end<br /><br />
    if @option.take_point &gt; 0 and ( @thisguy.savvy &lt; 1 and @thisguy.charisma &lt; 1 and @thisguy.skill &lt; 1 and @thisguy.looks &lt; 1 )<br /><br />
      s= s &lt;&lt; "You have no points left to sell, you masochist. "<br /><br />
    end<br /><br />
    if @thisguy.fans &lt; @option.fans_needed then<br /><br />
      s= s &lt;&lt; "You need at least #{@option.fans_needed} fans. "<br /><br />
    end<br /><br />
    if @option.give_charity_bar &gt; 0 and @thisguy.charity_bar &gt; 1<br /><br />
      s= s &lt;&lt; "You already have #{@thisguy.charity_bar==1 ? "1 box" : "2 boxes"} of candy bars. "<br /><br />
    end<br /><br />
    if @option.charity_bar_price &gt; 0 and @thisguy.charity_bar &lt; 1<br /><br />
      s= s &lt;&lt; "You can&#039;t sell candy bars that you don&#039;t have. "<br /><br />
    end<br /><br />
    #BURGER CHECK<br /><br />
    if @option.give_burger == 2<br /><br />
      if (@thisguy.burgers + 2) &gt; BURGER_LIMIT<br /><br />
        s= s &lt;&lt; "You can&#039;t carry any more burgers. "<br /><br />
      end<br /><br />
    end</p><br />
<br />
<br />
<p>    if @thisguy.has_car &lt; @option.car_needed then<br /><br />
      if @thisguy.has_car &gt; 0 then<br /><br />
        nicer = " nicer"<br /><br />
      end<br /><br />
      s= s &lt;&lt; "You need a #{nicer} car. "<br /><br />
    end<br /><br />
    if (s.strip) == "" then<br /><br />
      true<br /><br />
    else<br /><br />
      r = rand(5)<br /><br />
      if r==1 then<br /><br />
        @return_message="Sorry #{@thisguy.name}, you can&#039;t #{@option.name.upcase} Apparently you are not good enough right now. #{s}"<br /><br />
      elsif r==2<br /><br />
        @return_message="Sorry #{@thisguy.name}, you can&#039;t #{@option.name.upcase} It&#039;s not working out for you. #{s}"<br /><br />
      elsif r==3<br /><br />
        @return_message="Sorry #{@thisguy.name}, you can&#039;t #{@option.name.upcase} Maybe next time. #{s}"<br /><br />
      elsif r==4<br /><br />
        @return_message="Sorry #{@thisguy.name}, you can&#039;t #{@option.name.upcase} What a shame. #{s}"<br /><br />
      else<br /><br />
        @return_message="Sorry #{@thisguy.name}, you can&#039;t #{@option.name.upcase} You are coming up a little short. #{s}"<br /><br />
      end<br /><br />
      false<br /><br />
    end<br /><br />
  end</p><br />
<br />
<br />
<p>  def process_option!<br /><br />
    @option = Option.find_by_id(self.option_id)<br /><br />
    @thisguy=Actor.find_by_user_id(self.user_id)<br /><br />
    @thisguy.cash -= @option.cash_price.to_i<br /><br />
    self.current_enthusiasm -= @option.enthuse_price.to_i<br /><br />
    @thisguy.cash+=@option.cash_payout<br /><br />
    self.current_enthusiasm = (self.current_enthusiasm + @option.enthuse_payout)&gt;100 ? 100 : self.current_enthusiasm + @option.enthuse_payout<br /><br />
    @thisguy.charisma = @thisguy.charisma + (@thisguy.charisma*(@option.charisma_quotient*0.001))<br /><br />
    @thisguy.skill = @thisguy.skill + (@thisguy.skill*(@option.skill_quotient*0.001))<br /><br />
    @thisguy.savvy = @thisguy.savvy + (@thisguy.savvy*(@option.savvy_quotient*0.001))<br /><br />
    @thisguy.looks = @thisguy.looks + (@thisguy.looks*(@option.looks_quotient*0.001))<br /><br />
    if @option.cash_price &gt; 0 then<br /><br />
      s="You spent $#{@option.cash_price}. "<br /><br />
    else<br /><br />
      s=""<br /><br />
    end<br /><br />
    if @option.cash_payout &gt; 0 then<br /><br />
      s= s &lt;&lt; "You made $#{@option.cash_payout}. "<br /><br />
    end<br /><br />
    if @option.enthuse_payout &gt; 0 then<br /><br />
      s= s &lt;&lt; "You feel better. "<br /><br />
    end<br /><br />
    if @option.charisma_quotient &gt; 0 then<br /><br />
      s= s &lt;&lt; "Your mojo is off the hook. "<br /><br />
    end<br /><br />
    if @option.skill_quotient &gt; 0 then<br /><br />
      s= s &lt;&lt; "Your skill went up a bit. "<br /><br />
    end<br /><br />
    if @option.savvy_quotient &gt; 0 then<br /><br />
      s= s &lt;&lt; "Your savvy has improved. "<br /><br />
    end<br /><br />
    if @option.looks_quotient &gt; 0 then<br /><br />
      s= s &lt;&lt; "You just got prettier. "<br /><br />
    end<br /><br />
    if @option.give_car &gt; 0 then<br /><br />
      @thisguy.has_car = @option.give_car<br /><br />
      s= s &lt;&lt; "You got wheels. "<br /><br />
    end<br /><br />
    if @option.give_pet &gt; 0 then<br /><br />
      @thisguy.has_pet = @option.give_pet<br /><br />
      s= s &lt;&lt; "Your new pet loves you. "<br /><br />
    end<br /><br />
    if (@option.give_uniform == 1) and (@thisguy.has_uniform &lt; 1) then<br /><br />
      @thisguy.cash -= PRICE_OF_UNIFORM<br /><br />
      @thisguy.has_uniform = 1<br /><br />
      s= s &lt;&lt; "You paid $#{PRICE_OF_UNIFORM} for your uniform. "<br /><br />
    end<br /><br />
    if @option.give_box &gt; 0 then<br /><br />
      @thisguy.has_box = @option.give_box<br /><br />
      s= s &lt;&lt; "You now have somewhere to live. "<br /><br />
    end<br /><br />
    if @option.give_job &gt; 0 then<br /><br />
      @thisguy.has_job = @option.give_job<br /><br />
      @thisguy.works_at = @option.location_id<br /><br />
      @thisguy.last_pay_date = Time.now<br /><br />
      s= s &lt;&lt; "You just got hired. "<br /><br />
    end<br /><br />
    if @option.take_point &gt; 0<br /><br />
      whichever = rand(4)<br /><br />
      if whichever == 1<br /><br />
        @thisguy.skill -= 1<br /><br />
        name = "skill"<br /><br />
      elsif whichever == 2<br /><br />
        @thisguy.charisma -= 1<br /><br />
        name = "charisma"<br /><br />
      elsif whichever == 3<br /><br />
        @thisguy.savvy -= 1<br /><br />
        name = "savvy"<br /><br />
      else<br /><br />
        @thisguy.looks -= 1<br /><br />
        name = "looks"<br /><br />
      end<br /><br />
      s= s &lt;&lt; "You lost a point of #{name}. "<br /><br />
    end<br /><br />
    if @option.give_point &gt; 0<br /><br />
      if @option.give_point == 1<br /><br />
        quant = "1 point"<br /><br />
      else<br /><br />
        quant = "#{@option.give_point} points"<br /><br />
      end<br /><br />
      @thisguy.points_to_give += @option.give_point<br /><br />
      s= s &lt;&lt; "You gained #{quant} to use however you wish. Just click on the the PDA icon by your burgers."<br /><br />
    end<br /><br />
    if @option.take_job &gt; 0<br /><br />
      s= s &lt;&lt; ((@thisguy.has_job&gt;0) ? "You lost your job. " : "You got arrested for no reason. ")<br /><br />
      @thisguy.has_job = 0<br /><br />
    end<br /><br />
    if @option.give_guitar &gt; 0 then<br /><br />
      @thisguy.has_guitar = @option.give_guitar<br /><br />
      s= s &lt;&lt; "You bought the guitar. "<br /><br />
    end<br /><br />
    if @option.charity_bar_price &gt; 0<br /><br />
      @thisguy.charity_bar -= 1<br /><br />
      s= s &lt;&lt; "You sold a box of candy bars. "<br /><br />
    end<br /><br />
    if @option.give_acct &gt; 0 then<br /><br />
      @thisguy.has_acct = @option.give_acct<br /><br />
      s= s &lt;&lt; "You will be earning #{@option.give_acct * $SAVINGS_QUOTIENT}% interest. "<br /><br />
    end<br /><br />
    if @option.give_burger &gt; 0 then<br /><br />
      if @option.give_burger == 1 then<br /><br />
        burger_count = " 1 burger "<br /><br />
      else<br /><br />
        burger_count = " #{@option.give_burger} burgers "<br /><br />
      end<br /><br />
      if (@option.give_burger == 1) and (@thisguy.burgers == BURGER_LIMIT)<br /><br />
        s= s &lt;&lt; "You took a burger with you but it fell out of your pocket. "<br /><br />
      else</p><br />
<br />
<br />
<p>        @thisguy.burgers += @option.give_burger<br /><br />
        s= s &lt;&lt; "You wrapped up#{burger_count} to put in your pocket. "<br /><br />
      end<br /><br />
    end<br /><br />
    if @option.random_money &gt; 0 then<br /><br />
      r = rand(100)<br /><br />
      if @option.random_money &gt; (r - (@option.random_money/2)) then<br /><br />
        x = (@option.random_money * (r/1.6) + @option.random_money + (r * @option.random_money))<br /><br />
        @thisguy.cash += x<br /><br />
        s= s &lt;&lt; "You got lucky for an extra $#{(x).to_i}. "<br /><br />
      end<br /><br />
    end<br /><br />
    if @option.random_pet &gt; 0 then<br /><br />
      r = rand(100)<br /><br />
      if (@option.random_pet &gt;= r) then<br /><br />
        @thisguy.has_pet += 1<br /><br />
        s= s &lt;&lt; "You seduced a stray puppie with your charm. "<br /><br />
      end<br /><br />
    end<br /><br />
    #straight given fan<br /><br />
    if @option.give_fan &gt; 0<br /><br />
      netgain = @option.give_fan<br /><br />
        if netgain &gt; 1 then<br /><br />
          s_suffix = "s"<br /><br />
        else<br /><br />
          s_suffix = ""<br /><br />
        end<br /><br />
        @thisguy.fans += netgain<br /><br />
        s= s &lt;&lt; "#{netgain} new fan#{s_suffix} came up to you after the show. "<br /><br />
    end<br /><br />
    #random fan<br /><br />
    if @option.random_fan &gt; 0<br /><br />
      netgain = 0<br /><br />
      r = rand(90)<br /><br />
      if @option.random_fan &gt;= r then<br /><br />
        random_factor = 0<br /><br />
        for i in <a href="http://www.digbox.netmailto:r..@option.random_fan">r..@option.random_fan</a><br /><br />
          random_factor = (random_factor + i)<br /><br />
        end<br /><br />
        netgain = random_factor<br /><br />
      end<br /><br />
      if netgain &gt; 0 then<br /><br />
        if netgain &gt; 1 then<br /><br />
          s_suffix = "s"<br /><br />
        else<br /><br />
          s_suffix = ""<br /><br />
        end<br /><br />
        @thisguy.fans += netgain<br /><br />
        s= s &lt;&lt; "#{netgain} new fan#{s_suffix} came to your website. "<br /><br />
      end<br /><br />
    end if<br /><br />
    if @option.give_charity_bar &gt; 0<br /><br />
      @thisguy.charity_bar += 1<br /><br />
    end<br /><br />
    @return_message = s<br /><br />
    @thisguy.save<br /><br />
    self.save<br /><br />
  end</p><br />
<br />
<br />
<p>  def return_message<br /><br />
    @return_message<br /><br />
  end</p><br />
<br />
<br />
<p>  def return_message=(val)<br /><br />
    @return_message = val<br /><br />
  end<br /><br />
  def take_shelter!<br /><br />
    x = self.current_enthusiasm += 50<br /><br />
    if x &gt; 100<br /><br />
      x = 100<br /><br />
    end<br /><br />
    self.current_enthusiasm = x<br /><br />
  end</p><br />
<br />
<br />
<p>end</p><br />
<br />
<br />
<p><a href="http://www.digbox.net/index.php/RoR/another-ruby-model">Original post</a> blogged on <a href="http://codeboxer.com">codeboxer.com</a>.</p><br />
<br />

			<div class="post-meta">
                <span class="small">By</span> <span class="author vcard"><span class="fn"><a href="http://kristeraxel.com" title="Posts by Krister Axel" rel="author">Krister Axel</a></span></span> 
                <span class="small">on</span> <abbr class="date time published">02/07 2008 at 07_47</abbr> 
                <span class="small">in</span> 
                <span class="categories">
                    
						<a href="/category/Code/">Code</a> 
                    
                </span>
            </div>
		</div>
		<div id="ft">
			<br/>
<hr/>
<table id="footer">
	<tr>
	  <td><span class="leftcol">
	    <ul>
	      <li><a href="http://www.kristeraxel.com" rel="me" title="my home page" target="_blank">kristeraxel.com</a></li>
	      <li><a href="http://axelradio.com" rel="me" title="Download songs by Krister Axel and read the lyrics." target="_blank">Lyrics + Downloads</a></li>
	    </ul>
		</span>
	  </td>
	  <td><span class="midcol">
	    <small>&copy; 25 November 2012 Krister Axel<br/>All Rights Reserved.</small>
		</span>
	  </td>
	  <td><span class="rightcol">
	    <small>designed by <a href="http://kristeraxel.com">Krister Axel</a><br/>powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a></small>
		</span>
	  </td>
	</tr>
	
</table>
		</div>
	</div>
	</body>

</html>